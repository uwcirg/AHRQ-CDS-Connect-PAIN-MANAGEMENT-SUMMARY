{"version":3,"sources":["stubs/fhir-models.js","stubs/fhir-modelinfo-stub.xml.js","serviceWorker.js","utils/fontawesomeLibrary.js","containers/App.js","utils/extractResourcesFromELM.js","utils/executeELM.js","helpers/sumit.js","helpers/flagit.js","components/Header.js","helpers/formatit.js","helpers/sortit.js","icons/MedicalHistoryIcon.js","icons/PainIcon.js","icons/TreatmentsIcon.js","icons/RiskIcon.js","components/InclusionBanner.js","components/ExclusionBanner.js","components/InfoModal.js","components/FhirQuery.js","components/DevTools.js","components/Summary.js","elements/Spinner.js","components/Landing.js","containers/Root.js","index.js"],"names":["Patient","Bundle","Base","Boolean","window","location","hostname","match","library","add","faChevronLeft","faChevronRight","faCircle","faInfoCircle","faLink","faTimes","faExclamationCircle","faUserCircle","App","className","this","props","children","Component","extractResourcesFromExpression","resources","expression","Array","isArray","forEach","e","console","log","type","exec","dataType","error","Object","values","val","extractResourcesFromELM","elm","Set","name","source","statements","def","from","processPage","uri","collector","bundle","url","link","some","l","relation","find","push","data","entry","resource","executeELM","client","release","Promise","resolve","results","FHIR","oauth2","ready","then","clientArg","getFhirRelease","releaseNum","cql","Library","r4FactorsELM","Repository","CDS_Connect_Commons_for_FHIRv102","r4CommonsELM","FHIRHelpers","r4HelpersELM","patient","read","pt","id","requests","map","params","URLSearchParams","process","toLowerCase","set","join","updateSearchParams","request","pageLimit","onPage","catch","doSearch","all","requestResults","result","resourceType","r","patientSource","cqlfhir","PatientSource","FHIRv102","FHIRv400","Error","getPatientSource","codeService","CodeService","valueSetDB","executor","Executor","loadBundles","patientResults","keys","sumit","obj","reduce","sum","key","length","functions","ifAnd","flagRulesArray","subSection","summary","i","flagRule","rule","ifOr","ifNone","value","ifOneOrMore","table","entries","ifGreaterThanOrEqualTo","targetEntry","parseInt","header","flagit","flags","tables","flagResults","accumulator","flag","flagText","Header","patientName","patientAge","patientGender","totalEntries","numFlaggedEntries","meetsInclusionCriteria","src","alt","icon","title","aria-label","dateRE","quantityRE","booleanRE","dateFormat","input","moment","parseZone","format","dateAgeFormat","patientDOB","birthDate","_json","patientAgeAtDate","diff","datishFormat","_datishAgeFormat","datishAgeFormat","ageFormat","m","num","booleanFormat","arrayFlatten","property","propertyAria","showAria","question","ariaLabel","aria-hidden","quantityFormat","unit","showAge","df","test","Start","End","start","end","Low","High","low","high","slice","ageRE","stringCompare","a","b","localeCompare","numberCompare","aNum","parseFloat","bNum","dateCompare","getMoment","aMoment","bMoment","isValid","toISOString","ageCompare","toDays","quantityCompare","aM","bM","unitCmp","datishCompare","sortableValue","split","aVal","bVal","aIsDate","bIsDate","aIsAge","bIsAge","MedicalHistoryIcon","viewBox","xmlns","d","fillRule","PainIcon","cx","cy","TreatmentsIcon","RiskIcon","InclusionBanner","arguments","handleClose","setState","displayed","state","style","display","role","dismissible","onClick","ExclusionBanner","InfoModal","renderElements","elements","tableElements","columns","accessor","minWidth","description","aria-describedby","elementsTableProps","minRows","showPagination","resizable","getProps","renderReferences","references","maxWidth","sortable","reference","urlLink","href","target","rel","referencesTableProps","closeModal","info","el","filter","FhirQuery","toggleShowHide","event","preventDefault","JSON","stringify","DevTools","toggleDevTools","displayDevTools","toggleFhirQueries","displayFhirQueries","toggleCQLResults","displayCQLResults","er","message","statusText","errResponses","border","width","errorMessage","item","lastIndexOf","renderErrors","renderFHIRQueries","renderCQLResults","Summary","handleOpenModal","modalSubSection","keyCode","showModal","handleCloseModal","subsectionTableProps","ReactModal","setAppElement","section","sectionFlags","subSections","isSubsectionFlagged","flagged","entryId","_id","dataKey","flaggedClass","tooltip","data-tip","index","filteredEntries","negated","substring","headers","isEntryFlagged","Cell","headerKey","column","formatter","formatterArguments","formatit","sortMethod","sortit","customProps","replace","pageSizeOptions","defaultPageSize","summaryMap","dataKeySource","hasEntries","onKeyDown","tabIndex","renderNoEntries","renderTable","isSectionFlagged","numMedicalHistoryEntries","numPainEntries","numTreatmentsEntries","numRiskEntries","height","MeetsInclusionCriteria","trigger","renderSectionHeader","open","renderSection","overlayClassName","isOpen","onRequestClose","contentLabel","Spinner","uuid","Landing","loading","tocInitialized","executeElm","processSummary","flaggedCount","err","tocbot","init","tocSelector","contentSelector","headingSelector","positionFixedSelector","collapseDepth","includeHtml","Name","document","endpoint","apikey","applicationAnalytics","totalCount","sections","cloneSections","parse","sectionKey","subSectionKey","count","numEntries","totalNumEntries","jsonBody","requestOptions","body","method","fetch","sectionKeys","flaggedEntries","entryFlag","sectionFlagged","response","json","config","analytics_endpoint","getAnalyticsData","x_api_key","PertinentMedicalHistory","PainAssessments","HistoricalTreatments","RiskConsiderations","MiscellaneousItems","Age","Gender","Root","exact","path","component","displayName","render","basename","getElementById","navigator","serviceWorker","registration","unregister"],"mappings":"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","file":"static/js/main.d2869709.chunk.js","sourcesContent":["export class Patient{};\nexport class Bundle{};\nexport class Base{};","// A stubbed out version of node_modules/cql-exec-fhir/lib/modelInfos/fhir-modelinfo-*.xml.js\n// for modelinfos we don't use that take up a lot of space.\nexport default '';","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import { library } from '@fortawesome/fontawesome-svg-core';\nimport {\n  faChevronLeft,\n  faChevronRight,\n  faCircle,\n  faInfoCircle,\n  faLink,\n  faTimes,\n  faExclamationCircle,\n  faUserCircle\n} from '@fortawesome/free-solid-svg-icons';\n\nlibrary.add(\n  faChevronLeft,\n  faChevronRight,\n  faCircle,\n  faInfoCircle,\n  faLink,\n  faTimes,\n  faExclamationCircle,\n  faUserCircle\n);\n","import React, { Component } from 'react';\n\nexport default class App extends Component {\n  render() {\n    return (\n      <div className=\"App\">\n        {this.props.children}\n      </div>\n    );\n  }\n}\n","function extractResourcesFromELM(elm) {\n  const resources = new Set();\n  console.log(\"in extract resources\")\n  console.log(elm.name)\n  if (typeof elm !== \"undefined\" && elm && elm.source && elm.source.library && elm.source.library.statements && elm.source.library.statements.def) {\n    for (const expDef of Object.values(elm.source.library.statements.def)) {\n      extractResourcesFromExpression(resources, expDef.expression);\n    }\n  }\n  return Array.from(resources);\n}\n\nfunction extractResourcesFromExpression(resources, expression) {\n  if (expression && Array.isArray(expression)) {\n    expression.forEach(e => {\n      console.log(e)\n      if (typeof e == \"undefined\") return true;\n      extractResourcesFromExpression(resources, e);\n    });\n  } else if (expression && typeof expression === 'object') {\n    if (expression.type === 'Retrieve') {\n      const match = /^(\\{http:\\/\\/hl7.org\\/fhir\\})?([A-Z][a-zA-Z]+)$/.exec(expression.dataType);\n      if (match) {\n        resources.add(match[2]);\n      } else {\n        console.error('Cannot find resource for Retrieve w/ dataType: ', expression.dataType);\n      }\n    } else {\n      for (const val of Object.values(expression)) {\n        if (typeof val == \"undefined\") {\n          continue;\n        }\n        extractResourcesFromExpression(resources, val);\n      }\n    }\n  }\n}\n\nexport default extractResourcesFromELM;\n","import FHIR from 'fhirclient';\nimport cql from 'cql-execution';\nimport cqlfhir from 'cql-exec-fhir';\nimport extractResourcesFromELM from './extractResourcesFromELM';\nimport dstu2FactorsELM from '../cql/dstu2/Factors_to_Consider_in_Managing_Chronic_Pain.json'\nimport dstu2CommonsELM from '../cql/dstu2/CDS_Connect_Commons_for_FHIRv102.json';\nimport dstu2HelpersELM from '../cql/dstu2/FHIRHelpers.json';\nimport r4FactorsELM from '../cql/r4/Factors_to_Consider_in_Managing_Chronic_Pain_FHIRv400.json';\nimport r4CommonsELM from '../cql/r4/CDS_Connect_Commons_for_FHIRv400.json';\nimport r4HelpersELM from '../cql/r4/FHIRHelpers.json';\nimport valueSetDB from '../cql/valueset-db.json';\n\nfunction executeELM(collector) {\n  let client, release, library;\n  return new Promise((resolve) => {\n    // First get our authorized client and send the FHIR release to the next step\n    const results = FHIR.oauth2.ready().then((clientArg) => {\n      client = clientArg;\n      return client.getFhirRelease();\n    })\n    // then remember the release for later and get the release-specific library\n    .then((releaseNum) => {\n      release = releaseNum;\n      library = getLibrary(release);\n    })\n    // then query the FHIR server for the patient, sending it to the next step\n    .then(() => client.patient.read())\n    // then gather all the patient's relevant resource instances and send them in a bundle to the next step\n    .then((pt) => {\n      collector.push({ data: pt, url: `Patient/${pt.id}`});\n      const requests = extractResourcesFromELM(library).map((name) => {\n        if (name === 'Patient') {\n          return [pt];\n        }\n        return doSearch(client, release, name, collector);\n      });\n      // Don't return until all the requests have been resolved\n      return Promise.all(requests).then((requestResults) => {\n        const resources = [];\n        requestResults.forEach(result => resources.push(...result));\n        return {\n          resourceType: \"Bundle\",\n          entry: resources.map(r => ({ resource: r }))\n        };;\n      });\n    })\n    // then execute the library and return the results (wrapped in a Promise)\n    .then((bundle) => {\n      console.log(\"get source\")\n      const patientSource = getPatientSource(release);\n      console.log(\"get code service\")\n      const codeService = new cql.CodeService(valueSetDB);\n      console.log(\"executor\")\n      const executor = new cql.Executor(library, codeService);\n      console.log(\"load bundles \")\n      patientSource.loadBundles([bundle]);\n      console.log(\"execute patient source\");\n      console.log(patientSource);\n      const results = executor.exec(patientSource);\n      console.log(\"return\")\n      return results.patientResults[Object.keys(results.patientResults)[0]];\n    });\n    resolve(results);\n  });\n}\n\nfunction getLibrary(release) {\n  release = 4;\n  switch(release) {\n    case 2:\n      return new cql.Library(dstu2FactorsELM, new cql.Repository({\n        CDS_Connect_Commons_for_FHIRv102: dstu2CommonsELM,\n        FHIRHelpers: dstu2HelpersELM\n      }));\n    case 4:\n      return new cql.Library(r4FactorsELM, new cql.Repository({\n        CDS_Connect_Commons_for_FHIRv102: r4CommonsELM,\n        FHIRHelpers: r4HelpersELM\n      }));\n    default:\n      throw new Error('Only FHIR DSTU2 and FHIR R4 servers are supported');\n  }\n}\n\nfunction getPatientSource(release) {\n  switch(release) {\n    case 2:\n      return cqlfhir.PatientSource.FHIRv102();\n    case 4:\n      return cqlfhir.PatientSource.FHIRv400();\n    default:\n      throw new Error('Only FHIR DSTU2 and FHIR R4 servers are supported');\n  }\n}\n\nfunction doSearch(client, release, type, collector) {\n  const params = new URLSearchParams();\n  updateSearchParams(params, release, type);\n\n  const resources = [];\n  const uri = `${type}?${params}`;\n  return new Promise((resolve) => {\n    const results = client.patient.request(uri, {\n      pageLimit: 0, // unlimited pages\n      onPage: processPage(uri, collector, resources)\n    }).then(() => {\n      return resources;\n    }).catch((error) => {\n      collector.push({ error: error, url: uri, type: type, data: error });\n      // don't return the error as we want partial results if available\n      // (and we don't want to halt the Promis.all that wraps this)\n      return resources;\n    });\n    resolve(results);\n  });\n}\n\nfunction processPage(uri, collector, resources) {\n  return (bundle) => {\n    // Add to the collector\n    let url = uri;\n    if (bundle && bundle.link && bundle.link.some(l => l.relation === 'self' && l.url != null)) {\n      url = bundle.link.find(l => l.relation === 'self').url;\n    }\n    collector.push({ url: url, data: bundle});\n    // Add to the resources\n    if (bundle.entry) {\n      bundle.entry.forEach(e => resources.push(e.resource));\n    }\n  }\n}\n\nfunction updateSearchParams(params, release, type) {\n  // If this is for Epic, there are some specific modifications needed for the queries to work properly\n  if (process.env.REACT_APP_EPIC_SUPPORTED_QUERIES\n    && process.env.REACT_APP_EPIC_SUPPORTED_QUERIES.toLowerCase() === 'true') {\n    if (release === 2) {\n      switch (type) {\n        case 'Observation':\n          // Epic requires you to specify a category or code search parameter, so search on all categories\n          params.set('category', [\n            'social-history', 'vital-signs', 'imaging', 'laboratory', 'procedure', 'survey', 'exam', 'therapy'\n          ].join(','));\n          break;\n        case 'MedicationOrder':\n          // Epic returns only active meds by default, so we need to specifically ask for other types\n          // NOTE: purposefully omitting entered-in-error\n          params.set('status', ['active', 'on-hold', 'completed', 'stopped', 'draft'].join(','));\n          break;\n        case 'MedicationStatement':\n          // Epic returns only active meds by default, so we need to specifically ask for other types\n          // NOTE: purposefully omitting entered-in-error\n          params.set('status', ['active', 'completed', 'intended'].join(','));\n          break;\n        default:\n          //nothing\n      }\n    } else if (release === 4) {\n      // NOTE: Epic doesn't currently support R4, but assuming R4 versions of Epic would need this\n      switch (type) {\n        case 'Observation':\n          // Epic requires you to specify a category or code search parameter, so search on all categories\n          params.set('category', [\n            'social-history', 'vital-signs', 'imaging', 'laboratory', 'procedure', 'survey', 'exam', 'therapy',\n            'activity'\n          ].join(','));\n          break;\n        case 'MedicationRequest':\n          // Epic returns only active meds by default, so we need to specifically ask for other types\n          // NOTE: purposefully omitting entered-in-error\n          params.set('status', [\n            'active', 'on-hold', 'cancelled', 'completed', 'stopped', 'draft', 'unknown'\n          ].join(','));\n          break;\n        case 'MedicationStatement':\n          // Epic returns only active meds by default, so we need to specifically ask for other types\n          // NOTE: purposefully omitting entered-in-error and not-taken\n          params.set('status', [\n            'active', 'completed', 'intended', 'stopped', 'on-hold', 'unknown'\n          ].join(','));\n          break;\n        default:\n          //nothing\n      }\n    }\n  }\n}\n\nexport default executeELM;\n","// sums total number of entries for a given object\n// for each key/value pair, sums the following:\n//    if value = array, adds length of array to sum\n//    if value = object, adds 1\n//    if value = empty array or null, adds 0\nexport default function sumit(obj) {\n  const keys = Object.keys(obj);\n  return keys.reduce((sum, key) => {\n    let entry = obj[key];\n    if (entry == null) {\n      return sum;\n    } else if (Array.isArray(entry)) {\n      return sum + entry.length;\n    } else  {\n      return sum + 1;\n    }\n  }, 0);\n}\n","const functions = { ifAnd, ifOr, ifNone, ifOneOrMore, ifGreaterThanOrEqualTo };\n\n// returns false if the given entry should not be flagged\n// returns the flag text for an entry that should be flagged\nexport default function flagit(entry, subSection, summary) {\n  const flags = subSection.tables[0].flags;\n  if (flags == null) return false;\n\n  const flagResults = flags.reduce((accumulator, flag) => {\n    const flagRule = flag.flag;\n    if (flagRule === 'always') {\n      if (entry != null) {\n        accumulator.push(flag.flagText);\n      }\n    } else if (flagRule === 'ifNone' && entry == null) {\n      accumulator.push(flag.flagText);\n    } else if (typeof flagRule === 'string') {\n      if (functions[flagRule](entry, entry, subSection, summary)) {\n        accumulator.push(flag.flagText);\n      }\n    } else if (typeof flagRule === 'object') {\n      const rule = Object.keys(flagRule)[0];\n      if (functions[rule](flagRule[rule], entry, subSection, summary)) {\n        accumulator.push(flag.flagText);\n      }\n    }\n\n    return accumulator;\n  }, []);\n\n  return flagResults.length === 0 ? false : flagResults[0];\n}\n\nfunction ifAnd(flagRulesArray, entry, subSection, summary) {\n  for (let i = 0; i < flagRulesArray.length; ++i) {\n    const flagRule = flagRulesArray[i];\n\n    let match;\n    if (typeof flagRule === 'string') {\n      match = functions[flagRule](entry, entry, subSection, summary);\n    } else {\n      const rule = Object.keys(flagRule)[0];\n      match = functions[rule](flagRule[rule], entry, subSection, summary);\n    }\n\n    if (match === false) return false;\n  }\n\n  return true;\n}\n\nfunction ifOr(flagRulesArray, entry, subSection, summary) {\n  for (let i = 0; i < flagRulesArray.length; ++i) {\n    const flagRule = flagRulesArray[i];\n    let match;\n\n    if (typeof flagRule === 'string') {\n      match = functions[flagRule](entry, entry, subSection, summary);\n    } else {\n      const rule = Object.keys(flagRule)[0];\n      match = functions[rule](flagRule[rule], entry, subSection, summary);\n    }\n\n    if (match) return true;\n  }\n\n  return false;\n}\n\nfunction ifNone(value, entry, subSection, summary) {\n  return value == null;\n}\n\nfunction ifOneOrMore(value, entry, subSection, summary) {\n  if (value != null && value.table != null && value.source != null) {\n    const entries = summary[value.source][value.table];\n    if (entries == null) {\n      return false;\n    } else if (Array.isArray(entries)) {\n      return entries.length > 0;\n    } else {\n      return Object.keys(entries).length > 0;\n    }\n  }\n\n  return value != null;\n}\n\nfunction ifGreaterThanOrEqualTo(value, entry, subSection, summary) {\n  let targetEntry = entry;\n  if (value.table != null && value.source != null) {\n    targetEntry = summary[value.source][value.table];\n  }\n\n  if (targetEntry == null) return false;\n\n  return parseInt(targetEntry[value.header], 10) >= value.value;\n}\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\n\nexport default class Header extends Component {\n  render() {\n    const {\n      patientName, patientAge, patientGender, totalEntries, numFlaggedEntries, meetsInclusionCriteria\n    } = this.props;\n\n    return (\n      <header className=\"header\">\n        <div className=\"header__logo\">\n          {/* For development - adds a link back to sandbox patient list */}\n          {/* <a className=\"header__return-link\" href=\"/launch.html\" alt=\"back to patient list\">\n            <FontAwesomeIcon className=\"return-icon\" icon=\"chevron-left\" title=\"back\" />\n          </a> */}\n\n          <img className=\"header__logo-img\" src={process.env.PUBLIC_URL + \"/assets/images/logo.png\"}\n\n            alt=\"cds connect logo\" />\n\t\t\t{/* <span className=\"header__logo-text\">COSRI</span> */}\n\t\t  <span className=\"header__tagline-text\">Built with CDS Connect from AHRQ!</span>\n        </div>\n\n        <div className=\"header__summary\">\n          <div className=\"header__summary-patient\">\n            <FontAwesomeIcon className=\"patient-icon\" icon=\"user-circle\" title=\"patient\" />\n\n            <div className=\"patient-info\">\n              <h1 className=\"patient-name\">{patientName}</h1>\n\n              <div className=\"patient-demographics\">\n                <span className=\"patient-age\" aria-label=\"years\">{patientAge} YRS</span>\n                <span className=\"patient-gender\">{patientGender}</span>\n              </div>\n            </div>\n          </div>\n\n          {meetsInclusionCriteria &&\n\t\t\t  <div className=\"header__summary-dashboard\">\n              <div className=\"entries\">\n                <div className=\"entries-count total\">{totalEntries}</div>\n                <div className=\"entries-label\">Total Entries</div>\n              </div>\n\n              <div className=\"entries\">\n                <div className=\"entries-count flagged\">{numFlaggedEntries}</div>\n                <div className=\"entries-label\">Total<br/>Flags</div>\n              </div>\n            </div>\n          }\n        </div>\n      </header>\n    );\n  }\n}\n\nHeader.propTypes = {\n  patientName: PropTypes.string.isRequired,\n  patientAge: PropTypes.number.isRequired,\n  patientGender: PropTypes.string.isRequired,\n  totalEntries: PropTypes.number.isRequired,\n  numFlaggedEntries: PropTypes.number.isRequired,\n  meetsInclusionCriteria: PropTypes.bool.isRequired\n};\n","import React from 'react';\nimport moment from 'moment';\n\nconst dateRE = /^\\d{4}-\\d{2}-\\d{2}(T|\\b)/; // loosely matches '2012-04-05' or '2012-04-05T00:00:00.000+00:00'\nconst quantityRE = /^(\\d+(\\.\\d+)?)(\\s+(\\S+))?$/; // matches '40' or '40 a' (a is UCUM unit for years)\nconst booleanRE = /^(true|false)$/; // matches 'true' or 'false'\n\nexport function dateFormat(result, input) {\n  if (input == null) return '';\n  return moment.parseZone(input).format('YYYY-MMM-DD');\n}\n\nexport function dateAgeFormat(result, input) {\n  if (result == null || result.Patient == null || input == null) return '';\n  const patientDOB = result.Patient.birthDate._json;\n  const patientAgeAtDate = moment(input).diff(patientDOB, 'years');\n  return `${dateFormat(result, input)} (age ${patientAgeAtDate})`;\n}\n\nexport function datishFormat(result, input) {\n  return _datishAgeFormat(result, input, false);\n}\n\nexport function datishAgeFormat(result, input) {\n  return _datishAgeFormat(result, input, true);\n}\n\nexport function ageFormat(result, input) {\n  if (input == null) return '';\n  const m = quantityRE.exec(input);\n  if (m) {\n    const num = m[1];\n    if (m.length === 5 && m[4] != null) { // it has a unit\n      switch (m[4]) {\n        case 'a': case 'y': case 'yr': case 'yrs': case 'year': case 'years':\n          return `age ${num}`; // no unit, years is implied\n        case 'mo': case 'mos': case 'month': case 'months':\n          return `age ${num} months`;\n        case 'wk': case 'wks': case 'week': case 'weeks':\n          return `age ${num} weeks`;\n        case 'd': case 'day': case 'days':\n          return `age ${num} days`;\n        default:\n          return `age ${input}`;\n      }\n    }\n  }\n  // fall back to returning the age + string\n  return `age ${input}`;\n}\n\nexport function booleanFormat(result, input) {\n  if (input == null) return '';\n  return `${input}`;\n}\n\nexport function arrayFlatten(result, input, property, propertyAria, showAria) {\n  if (input == null) return '';\n  return input.map((question, i) => {\n    let ariaLabel = '';\n    if (showAria) ariaLabel = `${question[property]} - Question Score: ${question[propertyAria]}`;\n    return <span key={i} aria-hidden={!showAria} aria-label={ariaLabel}>{question[property]}<br /></span>;\n  });\n}\n\nexport function quantityFormat(result, input) {\n  if (input == null) return '';\n  const m = quantityRE.exec(input);\n  if (m) {\n    const num = m[1];\n    if (m.length === 5 && m[4] != null) { // it has a unit\n      // re-name MME/day unit\n      const unit = m[4] === '{MME}/d' ? 'MME/day' : m[4];\n      return `${num} ${unit}`;\n    }\n    return `${num}`;\n  }\n  // fall back to returning string\n  return input;\n}\n\nfunction _datishAgeFormat(result, input, showAge) {\n  const df = showAge ? dateAgeFormat : dateFormat;\n  if (input == null) {\n    return '';\n  } else if (typeof input === 'string') {\n    // Test if it looks like a date format\n    if (dateRE.test(input)) {\n      return df(result, input);\n    } else if (quantityRE.test(input)) {\n      return ageFormat(result, input);\n    } else if (booleanRE.test(input)) {\n      return booleanFormat(result, input);\n    }\n    // fall back to the string itself\n    return input;\n  } else if (input.Start || input.End) {\n    const start = input.Start ? df(result, input.Start) : 'unknown start';\n    const end = input.End ? df(result, input.End) : 'ongoing';\n    return `${start} - ${end}`;\n  } else if (input.Low || input.High) {\n    const low = input.Low ? ageFormat(result, input.Low) : 'age unknown';\n    const high = input.High ? ageFormat(result, input.High) : 'age unknown';\n    return `${low} - ${high.slice(4)}`; // slice removes 'age ' prefix\n  }\n  // fall back to the input string\n  return input;\n}\n","import moment from 'moment';\n\nconst dateRE = /^(\\d{4}-[A-Z][a-z][a-z]-\\d{2})( \\(age \\d+\\))?$/; // matches '2012-Jan-05' or '2012-Jan-05 (age 45)'\nconst quantityRE = /^(\\d+(\\.\\d+)?)(\\s+(\\S+))?$/; // matches '40' or '40 cm' (a is UCUM unit for years)\nconst ageRE = /^age (\\d+(\\.\\d+)?)( (.+))?$/; // matches 'age 40' or 'age 40 years'\n\nexport function stringCompare(a, b) {\n  if (a == null && b != null) {\n    return 1;\n  } else if (a != null && b == null) {\n    return -1;\n  } else if (typeof a === 'string' && typeof b === 'string') {\n    return a.localeCompare(b);\n  }\n  // else fall back to 0\n  return 0;\n}\n\nexport function numberCompare(a, b) {\n  if (a == null && b != null) {\n    return 1;\n  } else if (a != null && b == null) {\n    return -1;\n  } else if (a == null && b == null) {\n    return 0;\n  }\n  const aNum = typeof a === 'string' ? parseFloat(a) : a;\n  const bNum = typeof b === 'string' ? parseFloat(b) : b;\n  if (aNum < bNum) {\n    return -1;\n  } else if (aNum > bNum) {\n    return 1;\n  }\n  return 0;\n}\n\nexport function dateCompare(a, b) {\n  // Need to parse out the date from the string\n  const getMoment = (input) => {\n    const m = dateRE.exec(input);\n    if (m) {\n      return moment(m[1], 'YYYY-MMM-DD');\n    }\n  }\n  const aMoment = getMoment(a);\n  const bMoment = getMoment(b);\n  const aDate = aMoment && aMoment.isValid() ? aMoment.toISOString(true) : a;\n  const bDate = bMoment && bMoment.isValid() ? bMoment.toISOString(true) : b;\n  return stringCompare(aDate, bDate);\n}\n\nexport function ageCompare(a, b) {\n  const toDays = (input) => {\n    const m = ageRE.exec(input);\n    if (m) {\n      const num = parseFloat(m[1]);\n      if (m.length === 5 && m[4] != null) { // it has a unit\n        switch (m[4]) {\n          case 'a': case 'y': case 'yr': case 'yrs': case 'year': case 'years':\n            return num * 365.25\n          case 'mo': case 'mos': case 'month': case 'months':\n            return num * (365.25/12);\n          case 'wk': case 'wks': case 'week': case 'weeks':\n            return num * 7;\n          case 'd': case 'day': case 'days':\n            return num;\n          default:\n            // don't understand the unit\n            return;\n        }\n      } else {\n        // No unit is treated as years\n        return num * 365.25;\n      }\n    }\n    // else return undefined\n    return;\n  }\n\n  return numberCompare(toDays(a), toDays(b));\n}\n\nexport function quantityCompare(a, b) {\n  // First sort on units to keep like units together, then sort on numbers -- otherwise the units get intermingled\n  // which could be confusing.\n  const aM = quantityRE.exec(a);\n  const bM = quantityRE.exec(b);\n  if (aM == null && bM != null) {\n    return 1;\n  } else if (aM != null && bM == null) {\n    return -1;\n  } else if (aM == null && bM == null) {\n    return 0;\n  }\n  const aUnit = aM.length === 5 && aM[4] != null ? aM[4] : '';\n  const bUnit = bM.length === 5 && bM[4] != null ? bM[4] : '';\n  const unitCmp = stringCompare(aUnit, bUnit);\n  if (unitCmp !== 0) {\n    return unitCmp;\n  }\n  return numberCompare(aM[1], bM[1]);\n}\n\nexport function datishCompare(a, b) {\n  if (a == null && b != null) {\n    return 1;\n  } else if (a != null && b == null) {\n    return -1;\n  } else if (a == null && b == null) {\n    return 0;\n  }\n  // For ranges and periods, we only want the first part (e.g., '2 years' in the range  '2 years - 5 years')\n  const sortableValue = (input) => {\n    if (input) {\n      return input.split(' - ')[0];\n    }\n    return input;\n  }\n  const aVal = sortableValue(a);\n  const bVal = sortableValue(b);\n  // dates come before ages come before strings\n  const aIsDate = dateRE.test(aVal);\n  const bIsDate = dateRE.test(bVal);\n  const aIsAge = ageRE.test(aVal);\n  const bIsAge = ageRE.test(bVal);\n  if (aIsDate || bIsDate) {\n    if (aIsDate !== bIsDate) {\n      return aIsDate ? -1 : 1;\n    }\n    return dateCompare(aVal, bVal);\n  } else if (aIsAge || bIsAge) {\n    if (aIsAge !== bIsAge) {\n      return aIsAge ? -1 : 1;\n    }\n    return ageCompare(aVal, bVal);\n  }\n  // fall back to the string itself\n  return stringCompare(aVal, bVal);\n}\n","/* eslint-disable max-len */\n\nimport React from 'react';\n\nexport default function MedicalHistoryIcon(props) {\n  return (\n    <svg viewBox=\"0 0 30 40\" xmlns=\"http://www.w3.org/2000/svg\" {...props}>\n      <path d=\"M24.333 2.653h-3.378A2.683 2.683 0 0 0 18.275 0h-7.142a2.683 2.683 0 0 0-2.68 2.653h-3.38A5.078 5.078 0 0 0 0 7.723v26.49a5.078 5.078 0 0 0 5.073 5.072l19.26-.002a5.078 5.078 0 0 0 5.074-5.07V7.722a5.078 5.078 0 0 0-5.074-5.07zm-14.56.029c0-.75.61-1.361 1.36-1.361h7.142c.75 0 1.361.61 1.361 1.36v2.622H9.772V2.682zm18.313 31.53a3.756 3.756 0 0 1-3.753 3.75l-19.26.002a3.756 3.756 0 0 1-3.751-3.75V7.724a3.756 3.756 0 0 1 3.752-3.75h3.378v1.99c0 .365.296.661.66.661h11.185a.66.66 0 0 0 .66-.66V3.973h3.376a3.755 3.755 0 0 1 3.753 3.75v26.488zm-16.554-19.62h2.511v2.516a.66.66 0 0 0 1.321 0v-2.517h2.512a.66.66 0 1 0 0-1.32h-2.512v-2.509a.66.66 0 1 0-1.32 0v2.508h-2.512a.66.66 0 1 0 0 1.321zm11.137 13.423H6.74a.66.66 0 0 0 0 1.321H22.67a.66.66 0 1 0 0-1.32zm0-3.549H6.74a.66.66 0 1 0 0 1.321H22.67a.66.66 0 0 0 0-1.321zm0-3.55H6.74a.66.66 0 0 0 0 1.322H22.67a.66.66 0 0 0 0-1.322zm-3.984 10.649h-7.96a.66.66 0 1 0 0 1.321h7.96a.66.66 0 0 0 0-1.321z\" fillRule=\"nonzero\" />\n    </svg>\n  );\n}\n","/* eslint-disable max-len */\n\nimport React from 'react';\n\nexport default function PainIcon(props) {\n  return (\n    <svg viewBox=\"0 0 35 35\" xmlns=\"http://www.w3.org/2000/svg\" {...props}>\n      <g fillRule=\"nonzero\">\n        <path d=\"M17.24 2.126c8.24 0 14.96 6.722 14.96 14.962 0 8.24-6.72 14.961-14.96 14.961-8.24 0-14.924-6.721-14.924-14.961S9 2.126 17.24 2.126zm0-2.126C7.784 0 .152 7.633.152 17.088c0 9.455 7.632 17.087 17.088 17.087 9.455 0 17.087-7.632 17.087-17.087S26.695 0 17.24 0z\"/><circle cx=\"12.379\" cy=\"13.252\" r=\"2.582\"/><circle cx=\"22.366\" cy=\"13.252\" r=\"2.582\"/><path d=\"M17.088 19.632a13.357 13.357 0 0 0-10.253 4.747c-.987 1.177.646 2.582 1.519 1.518a11.222 11.222 0 0 1 8.696-4.1c3.417 0 6.607 1.594 8.696 4.138.949 1.14 2.62-.19 1.594-1.405-2.43-3-6.19-4.898-10.252-4.898z\" />\n      </g>\n    </svg>\n  );\n}\n","/* eslint-disable max-len */\n\nimport React from 'react';\n\nexport default function TreatmentsIcon(props) {\n  return (\n    <svg viewBox=\"0 0 36 38\" xmlns=\"http://www.w3.org/2000/svg\" {...props}>\n      <g fillRule=\"nonzero\">\n        <path d=\"M34.418 26.87c2.204-2.924 1.01-5.97-2.068-8.29-3.078-2.32-6.428-2.395-9.297 1.111l-3.786 4.935c-1.789-3.074-5.15-5.26-8.628-4.892-3.479.368-6.272 2.805-7.048 6.15-.777 3.344.622 6.918 3.528 9.016s6.53 1.966 10.044-.443c.438.655 1.5 2.11 3.464 2.825 2.043.944 4.9 1.204 7.32-1.263 1.08-1.101 3.237-4.15 6.471-9.148zM5.062 28.256c-.518-3.654 2.13-6.77 5.757-6.93 3.628-.16 6.456 1.53 7.452 4.713L5.062 28.255zm14.777 7.188a6.047 6.047 0 0 1-1.802-2.186c.08-.107.12-.24.189-.354.5-.826.874-1.727 1.117-2.682.112-.482.19-.975.232-1.477a11.147 11.147 0 0 0 .03-1.949l2.1-2.787 8.612 6.49-3.429 4.55c-1.515 2.01-4.67 2.187-7.049.395zm11.88-15.765c2.379 1.792 3.097 3.909 2.068 5.64l-2.655 4.098-8.611-6.49 2.718-3.607c1.201-1.594 4.103-1.433 6.48.359zM18.55 27.45c-.03 1.525-.587 3.846-1.56 5.021a6.795 6.795 0 0 1-6.559 2.336c-2.44-.486-4.991-2.698-5.034-5.324l13.153-2.033z\"/><path d=\"M27.598 5.166c-2.401.03-4.779.382-7.033 1.042-1.058-2.154-2.642-4.119-4.66-5.782-.306-.27-.74-.424-1.196-.426h-.008c-.452 0-.884.15-1.191.416-2.058 1.652-3.662 3.626-4.71 5.799-2.24-.646-4.597-1-6.978-1.049a1.916 1.916 0 0 0-1.224.372c-.326.255-.503.607-.486.971.402 7.805 4.602 11.158 14.498 11.57h.151c9.792-.32 13.999-3.668 14.516-11.556.023-.362-.146-.716-.467-.975-.316-.26-.758-.4-1.212-.382zM14.703 0a14.977 14.977 0 0 1 3.566 6.92v.114c.406 2.866-.694 5.763-3.537 9.23-2.83-3.51-3.94-6.41-3.573-9.226a1.704 1.704 0 0 0 0-.193A14.426 14.426 0 0 1 14.703 0zM3.24 6.48A16.67 16.67 0 0 1 8.535 7.82c-.022 1.44.212 2.872.69 4.23.019.055.032.107.05.16.084.235.182.471.276.706.095.234.206.485.319.727.081.182.163.351.254.53.198.392.416.789.655 1.189.029.047.053.096.082.145.243.402.505.808.789 1.219-5.476-1.115-7.79-4.045-8.41-10.248zm14.55 10.288c.047-.067.086-.132.131-.2a14.464 14.464 0 0 0 2.966-8.776 16.343 16.343 0 0 1 5.286-1.329c-.681 6.283-2.99 9.23-8.383 10.305z\" />\n      </g>\n    </svg>\n  );\n}\n","/* eslint-disable max-len */\n\nimport React from 'react';\n\nexport default function RiskIcon(props) {\n  return (\n    <svg viewBox=\"0 0 35 34\" xmlns=\"http://www.w3.org/2000/svg\" {...props}>\n      <g fillRule=\"nonzero\">\n        <path d=\"M17.102 8.75c-.878 0-1.59.942-1.59 2.104v7.574c0 1.162.712 2.104 1.59 2.104.879 0 1.591-.942 1.591-2.104v-7.574c0-1.162-.712-2.104-1.59-2.104zM17.102 21.875a1.59 1.59 0 0 0-1.59 1.59v.084a1.59 1.59 0 0 0 3.181 0v-.096a1.59 1.59 0 0 0-1.59-1.578z\"/><path d=\"M24.69.399H10.108c-1.342 0-2.43 1.067-2.43 2.383v4.766H2.814c-1.342 0-2.43 1.067-2.43 2.383v14.298c0 1.316 1.088 2.383 2.43 2.383h4.861v4.766c0 1.316 1.089 2.383 2.43 2.383h14.585c1.342 0 2.43-1.067 2.43-2.383v-4.766h4.862c1.342 0 2.43-1.067 2.43-2.383V9.93c0-1.316-1.088-2.383-2.43-2.383H27.12V2.782c0-1.316-1.088-2.383-2.43-2.383zm8.01 8.454v16.503h-6.122l-.808.778v6.02H9.023v-6.02l-.808-.778H2.094V8.853h6.12l.809-.778v-6.02H25.77v6.02l.808.778H32.7z\" />\n      </g>\n    </svg>\n  );\n}\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\n\nexport default class InclusionBanner extends Component {\n  constructor() {\n    super(...arguments);\n    this.state = {\n      displayed: true\n    };\n  }\n\n  handleClose = () => {\n    this.setState({ displayed: false });\n  }\n\n  render() {\n    return (\n      <div\n        className=\"inclusion-banner banner\"\n        style={{display: this.state.displayed ? 'block' : 'none'}}\n        role=\"banner\">\n        {this.props.dismissible &&\n          <FontAwesomeIcon className=\"close-button\" icon=\"times\" onClick={this.handleClose} title=\"close\" />\n        }\n\n        <div className=\"inclusion-banner__tag banner warning-inside\">\n          This patient does not meet the applicable criteria.\n        </div>\n\n        <div className=\"inclusion-banner__description\">\n          <strong><FontAwesomeIcon icon=\"exclamation-circle\" title=\"warning\" /> WARNING:</strong> This summary\n          applies to patients 18 years or older who meet at least one of the following criteria:\n\n          <ul>\n            <li>Has a condition likely to indicate chronic pain</li>\n            <li>Has an active opioid medication in the last 180 days</li>\n            <li>Has an active adjuvant analgesic medication in the last 180 days</li>\n          </ul>\n        </div>\n      </div>\n    );\n  }\n}\n\nInclusionBanner.propTypes = {\n  dismissible: PropTypes.bool.isRequired\n};\n","import React, { Component } from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\n\nexport default class ExclusionBanner extends Component {\n  constructor() {\n    super(...arguments);\n    this.state = {\n      displayed: true\n    };\n  }\n\n  handleClose = () => {\n    this.setState({ displayed: false });\n  }\n\n  render() {\n    return (\n      <div\n        className=\"exclusion-banner banner\"\n        style={{display: this.state.displayed ? 'block' : 'none'}}\n        role=\"banner\">\n        <FontAwesomeIcon className=\"close-button\" icon=\"times\" title=\"close\" onClick={this.handleClose} />\n\n        <div className=\"exclusion-banner__description\">\n          <strong><FontAwesomeIcon icon=\"exclamation-circle\" title=\"notice\" /> TAKE NOTICE:</strong> This summary is not\n          intended for patients who are undergoing <b>end-of-life care</b> (hospice or palliative) or <b>active cancer\n          treatment</b>.\n        </div>\n      </div>\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport ReactTable from 'react-table';\n\nexport default class InfoModal extends Component {\n\n  constructor () {\n    super(...arguments);\n\n    this.elementsTableProps = { id: 'react__elements__table'};\n    this.referencesTableProps = { id: 'react__references__table'};\n  }\n\n  renderElements = (elements) => {\n    const tableElements = elements.elements;\n    const columns = [{\n      Header: () => <span className=\"col-header\">Name</span>,\n      accessor: 'name',\n      minWidth: 225\n    },{\n      Header: () => <span className=\"col-header\">Status</span>,\n      accessor: 'status'\n    },{\n      Header: () => <span className=\"col-header\">Lookback</span>,\n      accessor: 'lookback'\n    }];\n    return (\n      <div className=\"element\" role=\"table\"\n           aria-label={elements.description} aria-describedby={this.elementsTableProps.id}>\n        <h4>{elements.description}</h4>\n        <ReactTable\n          className=\"elements__table\"\n          columns={columns}\n          data={tableElements}\n          minRows={1}\n          showPagination={false}\n          resizable={false}\n          getProps={() => this.elementsTableProps}\n        />\n      </div>\n    );\n  }\n\n  renderReferences = (references) => {\n    const columns = [{\n      Header:  () => <span className=\"col-header\">Link</span>,\n      accessor: 'urlLink',\n      maxWidth: 50,\n      sortable: false\n    },{\n      Header:  () => <span className=\"col-header\">Title</span>,\n      accessor: 'title'\n    },{\n      Header:  () => <span className=\"col-header\">Details</span>,\n      accessor: 'details'\n    }];\n\n    let data = references;\n    data.forEach((reference) => {\n      reference.urlLink = (\n        <a href={reference.url} src={reference.title} target=\"_blank\"\n           rel=\"noopener noreferrer\"><FontAwesomeIcon icon=\"link\" title=\"link\" /></a>\n      );\n    });\n\n    return (\n      <div className=\"reference\" role=\"table\"\n           aria-label=\"References\" aria-describedby={this.referencesTableProps.id}>\n        <ReactTable\n          className=\"elements__table\"\n          columns={columns}\n          data={data}\n          minRows={1}\n          showPagination={false}\n          resizable={false}\n          getProps={() => this.referencesTableProps}\n        />\n      </div>\n    );\n  }\n\n  render() {\n    const { subSection, closeModal } = this.props;\n    const elements = subSection.info.find((el) => el.type === \"elements\");\n    const references = subSection.info.filter((el) => el.type === \"reference\");\n\n    return (\n      <div className=\"info-modal\">\n        <div className=\"info-modal__header\">\n          More Information for {subSection.name}\n          <FontAwesomeIcon icon=\"times\" title=\"close\" className=\"close-icon\" onClick={closeModal}/>\n        </div>\n\n        <div className=\"info-modal__body\">\n          {elements != null &&\n            <div className=\"elements\">\n              {this.renderElements(elements)}\n            </div>\n          }\n\n          {references.length > 0 &&\n            <div className=\"references\">\n              <h4>References:</h4>\n              {this.renderReferences(references)}\n            </div>\n          }\n        </div>\n      </div>\n    );\n  }\n}\n\nInfoModal.propTypes = {\n  subSection: PropTypes.object,\n  closeModal: PropTypes.func.isRequired\n};\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\n\nexport default class FhirQuery extends Component {\n  constructor() {\n    super(...arguments);\n    this.state = {\n      displayed: false\n    };\n  }\n\n  toggleShowHide = (event) => {\n    event.preventDefault();\n    this.setState({ displayed: !this.state.displayed });\n  }\n\n  render() {\n    const { data, url } = this.props;\n    if (!data) { return null; }\n\n    return (\n      <div className=\"fhir-query\">\n        <b>{url}</b> <button href=\"#\" onClick={this.toggleShowHide}>[show/hide]</button>\n        <pre style={{display: this.state.displayed ? 'block' : 'none'}}>{JSON.stringify(data, null, 2)}</pre>\n      </div>\n    );\n  }\n}\n\nFhirQuery.propTypes = {\n  data: PropTypes.object.isRequired,\n  url: PropTypes.string.isRequired\n};\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\n\nimport FhirQuery from './FhirQuery';\n\nexport default class DevTools extends Component {\n  constructor() {\n    super(...arguments);\n    this.state = {\n      displayDevTools: false,\n      displayFhirQueries: false,\n      displayCQLResults: false\n    };\n  }\n\n  toggleDevTools = (event) => {\n    event.preventDefault();\n    this.setState({ displayDevTools: !this.state.displayDevTools });\n  }\n\n  toggleFhirQueries = (event) => {\n    event.preventDefault();\n    this.setState({ displayFhirQueries: !this.state.displayFhirQueries });\n  }\n\n  toggleCQLResults = (event) => {\n    event.preventDefault();\n    this.setState({ displayCQLResults: !this.state.displayCQLResults });\n  }\n\n  errorMessage(er, i) {\n    return (\n      <tr key={i}>\n        <td>{er.type}</td>\n        <td>{er.error.message || er.error.statusText || 'No error message provided'}</td>\n      </tr>\n    );\n  }\n\n  renderErrors() {\n    const errResponses = this.props.collector.filter(i => i.error);\n\n    if (errResponses.length) {\n      return (\n        <div className=\"cql-errors\">\n          <h4>{errResponses.length} Errors</h4>\n\n          <table id=\"cql-errors\" border=\"1\" width=\"100%\">\n            <thead>\n              <tr>\n                <th>Resource</th>\n                <th>Error</th>\n              </tr>\n            </thead>\n\n            <tbody>\n              {errResponses.map((er, i) => this.errorMessage(er, i))}\n            </tbody>\n          </table>\n        </div>\n      );\n    }\n\n    return <div></div>;\n  }\n\n  renderFHIRQueries() {\n    return (\n      <div className=\"fhir-queries\">\n        <h4>FHIR Queries <button onClick={this.toggleFhirQueries}>[show/hide]</button></h4>\n        <div style={{ display: this.state.displayFhirQueries ? 'block' : 'none' }}>\n          {this.props.collector.map((item, i) => {\n            const url = i === 0 ? item.url : item.url.slice(item.url.lastIndexOf('/') + 1);\n            return (\n              <FhirQuery key={i} url={url} data={item.data} />\n            );\n          })}\n        </div>\n      </div>\n    );\n  }\n\n  renderCQLResults() {\n    return (\n      <div className=\"cql-results\">\n        <h4>CQL Results <button onClick={this.toggleCQLResults}>[show/hide]</button></h4>\n\n        <div style={{ display: this.state.displayCQLResults ? 'block' : 'none' }}>\n          <pre>{JSON.stringify(this.props.result, null, 2)}</pre>\n        </div>\n      </div>\n    );\n  }\n\n  render() {\n    if (!this.props.collector) { return null; }\n\n    return (\n      <div className=\"dev-tools\">\n        <h4>Development Tools <button onClick={this.toggleDevTools}>[show/hide]</button></h4>\n\n        <div className=\"dev-tools__disclaimer\">\n          These development tools are for troubleshooting issues and intended to be used by technical support.\n        </div>\n\n        <div style={{ display: this.state.displayDevTools ? 'block' : 'none' }}>\n          {this.renderErrors()}\n          {this.renderFHIRQueries()}\n          {this.renderCQLResults()}\n        </div>\n      </div>\n    );\n  }\n}\n\nDevTools.propTypes = {\n  collector: PropTypes.array.isRequired,\n  result: PropTypes.object.isRequired\n};\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport Collapsible from 'react-collapsible';\nimport ReactTooltip from 'react-tooltip';\nimport ReactTable from 'react-table';\nimport ReactModal from 'react-modal';\n\nimport summaryMap from './summary.json';\nimport * as formatit from '../helpers/formatit';\nimport * as sortit from '../helpers/sortit';\n\nimport MedicalHistoryIcon from '../icons/MedicalHistoryIcon';\nimport PainIcon from '../icons/PainIcon';\nimport TreatmentsIcon from '../icons/TreatmentsIcon';\nimport RiskIcon from '../icons/RiskIcon';\n\nimport InclusionBanner from './InclusionBanner';\nimport ExclusionBanner from './ExclusionBanner';\nimport InfoModal from './InfoModal';\nimport DevTools from './DevTools';\n\nexport default class Summary extends Component {\n  constructor () {\n    super(...arguments);\n\n    this.state = {\n      showModal: false,\n      modalSubSection: null\n    };\n\n    this.subsectionTableProps = { id: 'react_sub-section__table'};\n\n    ReactModal.setAppElement('body');\n  }\n\n  handleOpenModal = (modalSubSection,event) => {\n    //only open modal   on 'enter' or click\n    if(event.keyCode === 13 || event.type === \"click\") {\n        this.setState({showModal: true, modalSubSection});\n    }\n  }\n\n  handleCloseModal = () => {\n    this.setState({ showModal: false });\n  }\n\n  isSectionFlagged(section) {\n    const { sectionFlags } = this.props;\n    const subSections = Object.keys(sectionFlags[section]);\n\n    for (let i = 0; i < subSections.length; ++i) {\n      if (this.isSubsectionFlagged(section, subSections[i])) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  isSubsectionFlagged(section, subSection) {\n    const { sectionFlags } = this.props;\n    if (sectionFlags[section][subSection] === true) {\n      return true;\n    } else if (sectionFlags[section][subSection] === false) {\n      return false;\n    } else {\n      return sectionFlags[section][subSection].length > 0;\n    }\n  }\n\n  // if flagged, returns flag text, else returns false\n  isEntryFlagged(section, subSection, entry) {\n    const { sectionFlags } = this.props;\n\n    let flagged = false;\n    sectionFlags[section][subSection].forEach((flag) => {\n      if (flag.entryId === entry._id) {\n        flagged = flag.flagText;\n      }\n    });\n\n    return flagged;\n  }\n\n  renderNoEntries(section, subSection) {\n    const flagged = this.isSubsectionFlagged(section, subSection.dataKey);\n    const flaggedClass = flagged ? 'flagged' : '';\n    const flagText = this.props.sectionFlags[section][subSection.dataKey];\n    const tooltip = flagged ? flagText : '';\n\n    return (\n      <div className=\"table\">\n        <div className=\"no-entries\">\n          <FontAwesomeIcon\n            className={`flag flag-no-entry ${flaggedClass}`}\n            icon=\"exclamation-circle\"\n            title={`flag: ${tooltip}`}\n            data-tip={tooltip}\n            role=\"tooltip\"\n          />\n          no entries found\n        </div>\n      </div>\n    );\n  }\n\n  renderTable(table, entries, section, subSection, index) {\n    // If a filter is provided, only render those things that have the filter field (or don't have it when it's negated)\n    let filteredEntries = entries;\n    if (table.filter && table.filter.length > 0) {\n      // A filter starting with '!' is negated (looking for absence of that field)\n      const negated = table.filter[0] === '!';\n      const filter = negated ? table.filter.substring(1) : table.filter;\n      filteredEntries = entries.filter(e => negated ? e[filter] == null : e[filter] != null);\n    }\n    if (filteredEntries.length === 0) return null;\n\n    const headers = Object.keys(table.headers);\n\n    let columns = [\n      {\n        id: 'flagged',\n        Header: <span aria-label=\"flag\"></span>,\n        accessor: (entry) => this.isEntryFlagged(section, subSection.dataKey, entry),\n        Cell: (props) =>\n          <FontAwesomeIcon\n            className={`flag flag-entry ${props.value ? 'flagged' : ''}`}\n            icon=\"exclamation-circle\"\n            title={props.value ? `flag: ${props.value}` : 'flag'}\n            data-tip={props.value ? props.value : ''}\n            role=\"tooltip\"\n          />,\n        sortable: false,\n        width: 35,\n        minWidth: 35\n      }\n    ];\n\n    headers.forEach((header) => {\n      const headerKey = table.headers[header];\n\n      const column = {\n        id: header,\n        Header: () => <span className=\"col-header\">{header}</span>,\n        accessor: (entry) => {\n          let value = entry[headerKey];\n          if (headerKey.formatter) {\n            const { result } = this.props;\n            let formatterArguments = headerKey.formatterArguments || [];\n            value = formatit[headerKey.formatter](result, entry[headerKey.key], ...formatterArguments);\n          }\n\n          return value;\n        },\n        sortable: headerKey.sortable !== false\n      };\n\n      if (column.sortable && headerKey.formatter) {\n        switch(headerKey.formatter) {\n          case 'dateFormat': case 'dateAgeFormat':\n            column.sortMethod = sortit.dateCompare;\n            break;\n          case 'datishFormat': case 'datishAgeFormat':\n            column.sortMethod = sortit.datishCompare;\n            break;\n          case 'ageFormat':\n            column.sortMethod = sortit.ageCompare;\n            break;\n          case 'quantityFormat':\n            column.sortMethod = sortit.quantityCompare;\n            break;\n          default:\n            // do nothing, rely on built-in sort\n        }\n      }\n\n      if (headerKey.minWidth != null) {\n        column.minWidth = headerKey.minWidth;\n      }\n\n      if (headerKey.maxWidth != null) {\n        column.maxWidth = headerKey.maxWidth;\n      }\n\n      columns.push(column);\n    });\n\n    //ReactTable needs an ID for aria-describedby\n    let tableID = subSection.name.replace(/ /g,\"_\") + \"-table\";\n    let customProps = {id:tableID};\n    return (\n      <div key={index} className=\"table\" role=\"table\"\n           aria-label={subSection.name} aria-describedby={customProps.id}>\n          <ReactTable\n            className=\"sub-section__table\"\n            columns={columns}\n            data={filteredEntries}\n            minRows={1}\n            showPagination={filteredEntries.length > 10}\n            pageSizeOptions={[10, 20, 50, 100]}\n            defaultPageSize={10}\n            resizable={false}\n            getProps={() => customProps}\n          />\n      </div>\n    );\n  }\n\n  renderSection(section) {\n    const sectionMap = summaryMap[section];\n\n    return sectionMap.map((subSection) => {\n      const data = this.props.summary[subSection.dataKeySource][subSection.dataKey];\n      const entries = (Array.isArray(data) ? data : [data]).filter(r => r != null);\n      const hasEntries = entries.length !== 0;\n\n      const flagged = this.isSubsectionFlagged(section, subSection.dataKey);\n      const flaggedClass = flagged ? 'flagged' : '';\n\n      return (\n        <div key={subSection.dataKey} className=\"sub-section h3-wrapper\">\n          <h3 id={subSection.dataKey} className=\"sub-section__header\">\n            <FontAwesomeIcon\n              className={`flag flag-nav ${flaggedClass}`}\n              icon={flagged ? 'exclamation-circle' : 'circle'}\n              title=\"flag\"\n            />\n            {subSection.name}\n            {subSection.info &&\n              <div\n                onClick={(event) => this.handleOpenModal(subSection,event)}\n                onKeyDown={(event) => this.handleOpenModal(subSection,event)}\n                role=\"button\"\n                tabIndex={0}\n                aria-label={subSection.name}>\n                <FontAwesomeIcon\n                  className='info-icon'\n                  icon=\"info-circle\"\n                  title={`more info: ${subSection.name}`}\n                  data-tip=\"more info\"\n                  role=\"tooltip\"\n                />\n              </div>\n            }\n          </h3>\n\n          {!hasEntries && this.renderNoEntries(section, subSection)}\n          {hasEntries && subSection.tables.map((table, index) =>\n            this.renderTable(table, entries, section, subSection, index))\n          }\n         </div>\n      );\n    });\n  }\n\n  renderSectionHeader(section) {\n    const flagged = this.isSectionFlagged(section);\n    const flaggedClass = flagged ? 'flagged' : '';\n    const { numMedicalHistoryEntries, numPainEntries, numTreatmentsEntries, numRiskEntries } = this.props;\n\n    let icon = '';\n    let title = '';\n    if (section === 'PertinentMedicalHistory') {\n      icon = <MedicalHistoryIcon width=\"30\" height=\"40\" />;\n      title = `Pertinent Medical History (${numMedicalHistoryEntries})`;\n    } else if (section === 'PainAssessments') {\n      icon = <PainIcon width=\"35\"  height=\"35\" />;\n      title = `Pain Assessments (${numPainEntries})`\n    } else if (section === 'HistoricalTreatments') {\n      icon = <TreatmentsIcon width=\"36\" height=\"38\" />;\n      title = `Historical Pain-related Treatments (${numTreatmentsEntries})`\n    } else if (section === 'RiskConsiderations') {\n      icon = <RiskIcon width=\"35\" height=\"34\" />;\n      title = `Risk Considerations (${numRiskEntries})`;\n    }\n\n    return (\n      <h2 id={section} className=\"section__header\">\n        <div className=\"section__header-title\">\n          {icon}\n\n          <span>\n            {title}\n            <FontAwesomeIcon className={`flag flag-header ${flaggedClass}`} icon=\"exclamation-circle\" title=\"flag\" />\n          </span>\n        </div>\n\n        <FontAwesomeIcon className=\"chevron\" icon=\"chevron-right\" title=\"expand/collapse\" />\n      </h2>\n    );\n  };\n\n  render() {\n    const { summary, collector, result } = this.props;\n    const meetsInclusionCriteria = summary.Patient.MeetsInclusionCriteria;\n    if (!summary) { return null; }\n\n    return (\n      <div className=\"summary\">\n        <div className=\"summary__nav-wrapper\"><nav className=\"summary__nav\"></nav></div>\n\n        <div className=\"summary__display\" id=\"maincontent\">\n          <div className=\"summary__display-title\">\n            Clinical Opioid Summary to Reduce Impact\n          </div>\n\n          {meetsInclusionCriteria && <ExclusionBanner />}\n\n          {!meetsInclusionCriteria && <InclusionBanner dismissible={meetsInclusionCriteria} />}\n\n          {meetsInclusionCriteria &&\n            <div className=\"sections\">\n            {/*  <Collapsible trigger={this.renderSectionHeader(\"PertinentMedicalHistory\")} open={true}>\n                {this.renderSection(\"PertinentMedicalHistory\")}\n              </Collapsible>\n\n              <Collapsible tabIndex={0} trigger={this.renderSectionHeader(\"PainAssessments\")} open={true}>\n                {this.renderSection(\"PainAssessments\")}\n             </Collapsible>\n\t\t\t*/}\n              <Collapsible trigger={this.renderSectionHeader(\"HistoricalTreatments\")} open={true}>\n                {this.renderSection(\"HistoricalTreatments\")}\n              </Collapsible>\n\n            {/*  <Collapsible trigger={this.renderSectionHeader(\"RiskConsiderations\")} open={true}>\n                {this.renderSection(\"RiskConsiderations\")}\n              </Collapsible>\n\t\t\t */} \n            </div>\n          }\n\n          <div className=\"cdc-disclaimer\">\n            Please see the\n            <a\n              href=\"https://www.cdc.gov/mmwr/volumes/65/rr/rr6501e1.htm\"\n              alt=\"CDC Guideline for Prescribing Opioids for Chronic Pain\"\n              target=\"_blank\"\n              rel=\"noopener noreferrer\">\n              CDC Guideline for Prescribing Opioids for Chronic Pain\n            </a>\n            for additional information and prescribing guidance.\n          </div>\n\t\t  \n\t       <div  className=\"cdc-disclaimer\">\n            This application was built using CDS Connect from AHRQ.  Funding was provided by.....\n\t\t\tLorem ipsum dolor sit amet, consectetur adipibore et dolore magna aliqua.\n          </div>\n\t\t  \t  \n\t\t  \n\n          <DevTools\n            collector={collector}\n            result={result}\n          />\n\n          <ReactTooltip className=\"summary-tooltip\" />\n\n          <ReactModal\n            className=\"modal\"\n            overlayClassName=\"overlay\"\n            isOpen={this.state.showModal}\n            onRequestClose={this.handleCloseModal}\n            contentLabel=\"More Info\">\n            <InfoModal\n              closeModal={this.handleCloseModal}\n              subSection={this.state.modalSubSection} />\n          </ReactModal>\n        </div>\n      </div>\n    );\n  }\n}\n\nSummary.propTypes = {\n  summary: PropTypes.object.isRequired,\n  sectionFlags: PropTypes.object.isRequired,\n  collector: PropTypes.array.isRequired,\n  result: PropTypes.object.isRequired,\n  numMedicalHistoryEntries: PropTypes.number.isRequired,\n  numPainEntries: PropTypes.number.isRequired,\n  numTreatmentsEntries: PropTypes.number.isRequired,\n  numRiskEntries: PropTypes.number.isRequired\n};\n","import React from 'react';\n\nconst Spinner = () => {\n  return (\n    <div className=\"spinner\" role=\"img\" aria-label=\"Loading\">\n      <div className=\"bounce1\"></div>\n      <div className=\"bounce2\"></div>\n      <div className=\"bounce3\"></div>\n    </div>\n  );\n}\n\nexport default Spinner;\n","import React, { Component } from 'react';\nimport tocbot from 'tocbot';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\n\nimport executeElm from '../utils/executeELM';\nimport sumit from '../helpers/sumit';\nimport flagit from '../helpers/flagit';\nimport summaryMap from './summary.json';\n\nimport Header from './Header';\nimport Summary from './Summary';\nimport Spinner from '../elements/Spinner';\n\n\nlet uuid = 0;\n\nfunction generateUuid() {\n  return ++uuid; // eslint-disable-line no-plusplus\n}\n\nexport default class Landing extends Component {\n  constructor() {\n    super(...arguments);\n    this.state = {\n      result: null,\n      loading: true,\n      collector: []\n    };\n\n    this.tocInitialized = false;\n  }\n\n  componentDidMount() {\n    executeElm(this.state.collector).then((result) => {\n      this.setState({ loading: false });\n      const { sectionFlags, flaggedCount } = this.processSummary(result.Summary);\n      this.setState({ result, sectionFlags, flaggedCount });\n    }).catch((err) => {\n      console.error(err);\n      this.setState({ loading: false });\n    });\n  }\n\n  componentDidUpdate() {\n    if (!this.tocInitialized && !this.state.loading && this.state.result) {\n      tocbot.init({\n        tocSelector: '.summary__nav',           // where to render the table of contents\n        contentSelector: '.summary__display',   // where to grab the headings to build the table of contents\n        headingSelector: 'h2, h3',              // which headings to grab inside of the contentSelector element\n        positionFixedSelector: '.summary__nav', // element to add the positionFixedClass to\n        collapseDepth: 0,                       // how many heading levels should not be collpased\n        includeHtml: true                       // include the HTML markup from the heading node, not just the text\n      });\n\n      this.tocInitialized = true;\n    }\n\n    if (this.state.result && this.state.result.Summary.Patient.Name) {\n      const patientName = this.state.result.Summary.Patient.Name;\n      document.title = `Pain Management Summary - ${patientName}`;\n    }\n  }\n\n  getAnalyticsData(endpoint, apikey, summary) {\n    const meetsInclusionCriteria = summary.Patient.MeetsInclusionCriteria;\n    const applicationAnalytics = {\n      meetsInclusionCriteria\n    };\n\n    if (meetsInclusionCriteria) {\n      let totalCount = 0;\n      applicationAnalytics.sections = [];\n\n      const cloneSections = JSON.parse(JSON.stringify(summary));\n      delete cloneSections.Patient;\n\n      // Build total number of entries for each subsection of the summary.\n      Object.keys(cloneSections).forEach((sectionKey, i) => {\n        applicationAnalytics.sections.push({ section: sectionKey, subSections: [] });\n        Object.keys(cloneSections[sectionKey]).forEach(subSectionKey => {\n          const subSection = cloneSections[sectionKey][subSectionKey];\n          let count;\n          if (subSection instanceof Array) count = subSection.length;\n          else if (subSection instanceof Object) count = 1;\n          else count = 0;\n          totalCount += count;\n          applicationAnalytics.sections[i].subSections.push({\n            subSection: subSectionKey, numEntries: count\n          });\n        });\n      });\n\n      applicationAnalytics.totalNumEntries = totalCount;\n    }\n\n    let jsonBody = JSON.stringify(applicationAnalytics);\n\n    const requestOptions = {\n      body: jsonBody,\n      headers: {\n        'x-api-key': `${apikey}`,\n        'Content-Type': 'application/json',\n        'Content-Length': jsonBody.length\n      },\n      method: 'POST'\n    };\n\n    fetch(`${endpoint}`, requestOptions)\n      .catch(err => { console.log(err) });\n  }\n\n  processSummary(summary) {\n    const sectionFlags = {};\n    const sectionKeys = Object.keys(summaryMap);\n    let flaggedCount = 0;\n\n    sectionKeys.forEach((sectionKey, i) => { // for each section\n      sectionFlags[sectionKey] = {};\n\n      summaryMap[sectionKey].forEach((subSection) => { // for each sub section\n        const data = summary[subSection.dataKeySource][subSection.dataKey];\n        const entries = (Array.isArray(data) ? data : [data]).filter(r => r != null);\n\n        if (entries.length > 0) {\n          sectionFlags[sectionKey][subSection.dataKey] = entries.reduce((flaggedEntries, entry) => {\n            if (entry._id == null) {\n              entry._id = generateUuid();\n            }\n\n            const entryFlag = flagit(entry, subSection, summary);\n\n            if (entryFlag) {\n              flaggedEntries.push({ 'entryId': entry._id, 'flagText': entryFlag });\n              flaggedCount += 1;\n            }\n\n            return flaggedEntries;\n          }, []);\n        } else {\n          const sectionFlagged = flagit(null, subSection, summary);\n          sectionFlags[sectionKey][subSection.dataKey] = sectionFlagged;\n\n          if (sectionFlagged) {\n            flaggedCount += 1;\n          }\n        }\n      });\n    });\n\n    // Get the configured endpoint to use for POST for app analytics\n    fetch(`${process.env.PUBLIC_URL}/config.json`)\n      .then(response => response.json())\n      .then(config => {\n        // Only provide analytics if the endpoint has been set\n        if (config.analytics_endpoint) {\n          this.getAnalyticsData(config.analytics_endpoint, config.x_api_key, summary);\n        }\n      })\n      .catch(err => { console.log(err) });\n\n    return { sectionFlags, flaggedCount };\n  }\n\n  render() {\n    if (this.state.loading) {\n      return <Spinner />;\n    }\n\n    if (this.state.result == null) {\n      return (\n        <div className=\"banner error\">\n          <FontAwesomeIcon icon=\"exclamation-circle\" title=\"error\" /> Error: See console for details.\n        </div>\n      );\n    }\n\n    const summary = this.state.result.Summary;\n    const { sectionFlags, flaggedCount } = this.state;\n    const numMedicalHistoryEntries = sumit(summary.PertinentMedicalHistory || {});\n    const numPainEntries = sumit(summary.PainAssessments || {});\n    const numTreatmentsEntries = sumit(summary.HistoricalTreatments || {});\n    const numRiskEntries =\n      sumit(summary.RiskConsiderations || {}) +\n      sumit(summary.MiscellaneousItems || {}); // TODO: update when CQL updates\n    const totalEntries = numMedicalHistoryEntries + numPainEntries + numTreatmentsEntries + numRiskEntries;\n\n    return (\n      <div className=\"landing\">\n        <div id=\"skiptocontent\"><a href=\"#maincontent\">skip to main content</a></div>\n\n        <Header\n          patientName={summary.Patient.Name}\n          patientAge={summary.Patient.Age}\n          patientGender={summary.Patient.Gender}\n          totalEntries={totalEntries}\n          numFlaggedEntries={flaggedCount}\n          meetsInclusionCriteria={summary.Patient.MeetsInclusionCriteria}\n        />\n\n        <Summary\n          summary={summary}\n          sectionFlags={sectionFlags}\n          collector={this.state.collector}\n          result={this.state.result}\n          numMedicalHistoryEntries={numMedicalHistoryEntries}\n          numPainEntries={numPainEntries}\n          numTreatmentsEntries={numTreatmentsEntries}\n          numRiskEntries={numRiskEntries}\n        />\n      </div>\n    );\n  }\n}\n","import React from 'react';\nimport { Route, Switch } from 'react-router-dom';\n\nimport App from './App';\nimport Landing from '../components/Landing';\n\nconst Root = (props) => {\n  return (\n    <App>\n      <Switch>\n        <Route exact path=\"/\" component={Landing} />\n      </Switch>\n    </App>\n  );\n}\n\nRoot.displayName = 'Root';\n\nexport default Root;\n","import '@babel/polyfill';\nimport React from 'react';\nimport { render } from 'react-dom';\nimport { BrowserRouter as Router } from 'react-router-dom';\nimport * as serviceWorker from './serviceWorker';\n\nimport './utils/fontawesomeLibrary';\n\nimport Root from './containers/Root';\n\nimport './styles/App.scss';\n\nrender(\n  <Router basename={process.env.PUBLIC_URL}>\n    <Root />\n  </Router>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}